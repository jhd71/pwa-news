<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="theme-color" content="#0f0f1a">
    <title>M√©t√©o Montceau - Actu & M√©dia</title>
    <meta name="description" content="Pr√©visions m√©t√©o 7 jours pour Montceau-les-Mines et sa r√©gion">
    
    <link rel="manifest" href="/manifest.json">
    <link rel="icon" type="image/png" sizes="192x192" href="/icons/icon-192.png">
    <link rel="apple-touch-icon" href="/icons/icon-192.png">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/meteo-v2.css">
    <link rel="stylesheet" href="css/weather-icons-v2.css">
</head>
<body>
    
    <!-- Header -->
    <header class="header glass">
        <div class="header-top">
            <div class="header-left-btns">
    <a href="index.html" class="home-btn" title="Accueil">
        <span class="material-icons">home</span>
	</a>
		</div>
            <div class="header-title">
                <span class="logo">üå§Ô∏è</span>
                <h1>M√©t√©o</h1>
            </div>
            <div class="header-right-btns">
                <button class="theme-toggle" id="themeToggle" aria-label="Changer de th√®me">
                    <span class="material-icons" id="themeIcon">dark_mode</span>
                </button>
            </div>
        </div>
    </header>

    <!-- Localisation -->
    <section class="meteo-location">
        <div class="meteo-location-icon">
            <span class="material-icons">location_on</span>
        </div>
        <div class="meteo-location-text">
            <span class="meteo-city">Montceau-les-Mines</span>
            <span class="meteo-region">Sa√¥ne-et-Loire, Bourgogne</span>
        </div>
    </section>

    <!-- M√©t√©o actuelle - Hero Card -->
    <section class="meteo-current">
        <div class="meteo-current-main">
            <div class="meteo-current-icon" id="currentIcon"></div>
            <div class="meteo-current-temp">
                <span class="meteo-temp-value" id="currentTemp">--</span>
                <span class="meteo-temp-unit">¬∞C</span>
            </div>
        </div>
        <div class="meteo-current-desc" id="currentDesc">Chargement...</div>
        <div class="meteo-current-details">
            <div class="meteo-detail">
                <span class="material-icons">thermostat</span>
                <span>Ressenti <strong id="currentFeels">--¬∞</strong></span>
            </div>
            <div class="meteo-detail">
                <span class="material-icons">water_drop</span>
                <span>Humidit√© <strong id="currentHumidity">--%</strong></span>
            </div>
            <div class="meteo-detail">
                <span class="material-icons">air</span>
                <span>Vent <strong id="currentWind">-- km/h</strong></span>
            </div>
        </div>
    </section>

    <!-- Lever/Coucher du soleil -->
    <section class="meteo-sun">
        <div class="meteo-sun-item">
            <div class="meteo-sun-icon sunrise">
                <span class="material-icons">wb_sunny</span>
            </div>
            <div class="meteo-sun-info">
                <span class="meteo-sun-label">Lever</span>
                <span class="meteo-sun-time" id="sunrise">--:--</span>
            </div>
        </div>
        <div class="meteo-sun-progress">
            <div class="meteo-sun-bar">
                <div class="meteo-sun-fill" id="sunFill"></div>
                <div class="meteo-sun-position" id="sunPosition"></div>
            </div>
        </div>
        <div class="meteo-sun-item">
            <div class="meteo-sun-icon sunset">
                <span class="material-icons">nights_stay</span>
            </div>
            <div class="meteo-sun-info">
                <span class="meteo-sun-label">Coucher</span>
                <span class="meteo-sun-time" id="sunset">--:--</span>
            </div>
        </div>
    </section>

    <!-- Pr√©visions 7 jours -->
    <section class="meteo-forecast">
        <h2 class="meteo-section-title">
            <div class="icon-box">
                <span class="material-icons">date_range</span>
            </div>
            Pr√©visions 7 jours
        </h2>
        <div class="meteo-forecast-list" id="forecastList">
            <div class="meteo-loading">
                <span class="material-icons">sync</span>
                Chargement des pr√©visions...
            </div>
        </div>
    </section>

    <!-- D√©tails suppl√©mentaires -->
    <section class="meteo-extra">
        <h2 class="meteo-section-title">
            <div class="icon-box">
                <span class="material-icons">info</span>
            </div>
            D√©tails
        </h2>
        <div class="meteo-extra-grid">
            <div class="meteo-extra-item">
                <div class="meteo-extra-icon">
                    <span class="material-icons">compress</span>
                </div>
                <span class="meteo-extra-label">Pression</span>
                <span class="meteo-extra-value" id="pressure">-- hPa</span>
            </div>
            <div class="meteo-extra-item">
                <div class="meteo-extra-icon">
                    <span class="material-icons">visibility</span>
                </div>
                <span class="meteo-extra-label">Visibilit√©</span>
                <span class="meteo-extra-value" id="visibility">-- km</span>
            </div>
            <div class="meteo-extra-item">
                <div class="meteo-extra-icon">
                    <span class="material-icons">wb_twilight</span>
                </div>
                <span class="meteo-extra-label">Indice UV</span>
                <span class="meteo-extra-value" id="uvIndex">--</span>
            </div>
            <div class="meteo-extra-item">
                <div class="meteo-extra-icon">
                    <span class="material-icons">cloud</span>
                </div>
                <span class="meteo-extra-label">Couverture</span>
                <span class="meteo-extra-value" id="cloudCover">--%</span>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="meteo-footer">
        <p>Donn√©es <a href="https://open-meteo.com/" target="_blank" rel="noopener">Open-Meteo</a></p>
        <p class="footer-sub">Mise √† jour automatique</p>
    </footer>

    <script>
        // ============================================
        // M√âT√âO D√âTAILL√âE v2 - Montceau-les-Mines
        // ============================================
        
        const METEO_CONFIG = {
            latitude: 46.6667,
            longitude: 4.3667,
            timezone: 'Europe/Paris'
        };

        // Th√®me
        const THEMES = ['dark', 'light'];
        const THEME_ICONS = { 'dark': 'dark_mode', 'light': 'light_mode' };

        document.addEventListener('DOMContentLoaded', () => {
            initTheme();
            loadWeatherData();
        });

        function initTheme() {
            const saved = localStorage.getItem('theme') || 'dark';
            applyTheme(saved);
            
            document.getElementById('themeToggle').addEventListener('click', () => {
                const current = document.documentElement.getAttribute('data-theme') || 'dark';
                const next = current === 'dark' ? 'light' : 'dark';
                applyTheme(next);
                localStorage.setItem('theme', next);
            });
        }

        function applyTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            document.getElementById('themeIcon').textContent = THEME_ICONS[theme] || 'dark_mode';
        }

        async function loadWeatherData() {
            try {
                const url = `https://api.open-meteo.com/v1/forecast?latitude=${METEO_CONFIG.latitude}&longitude=${METEO_CONFIG.longitude}&current=temperature_2m,relative_humidity_2m,apparent_temperature,weather_code,wind_speed_10m,surface_pressure,cloud_cover&daily=weather_code,temperature_2m_max,temperature_2m_min,sunrise,sunset,uv_index_max,precipitation_probability_max&timezone=${METEO_CONFIG.timezone}`;
                
                const response = await fetch(url);
                if (!response.ok) throw new Error('Erreur API');
                
                const data = await response.json();
                
                updateCurrentWeather(data.current, data.daily);
                updateForecast(data.daily);
                updateExtras(data.current, data.daily);
                
                console.log('üå§Ô∏è M√©t√©o charg√©e');
                
            } catch (error) {
                console.error('‚ùå Erreur m√©t√©o:', error);
                document.getElementById('currentDesc').textContent = 'Erreur de chargement';
            }
        }

        function updateCurrentWeather(current, daily) {
            document.getElementById('currentTemp').textContent = Math.round(current.temperature_2m);
            document.getElementById('currentIcon').innerHTML = getWeatherIconV2(current.weather_code, 'xlarge');
            document.getElementById('currentDesc').textContent = getWeatherDescription(current.weather_code);
            document.getElementById('currentFeels').textContent = Math.round(current.apparent_temperature) + '¬∞';
            document.getElementById('currentHumidity').textContent = current.relative_humidity_2m + '%';
            document.getElementById('currentWind').textContent = Math.round(current.wind_speed_10m) + ' km/h';
            
            // Lever/coucher du soleil
            const sunrise = new Date(daily.sunrise[0]);
            const sunset = new Date(daily.sunset[0]);
            document.getElementById('sunrise').textContent = sunrise.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' });
            document.getElementById('sunset').textContent = sunset.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' });
            
            // Position du soleil
            updateSunPosition(sunrise, sunset);
        }

        function updateSunPosition(sunrise, sunset) {
            const now = new Date();
            const sunriseTime = sunrise.getTime();
            const sunsetTime = sunset.getTime();
            const nowTime = now.getTime();
            
            let percentage = 0;
            if (nowTime < sunriseTime) {
                percentage = 0;
            } else if (nowTime > sunsetTime) {
                percentage = 100;
            } else {
                percentage = ((nowTime - sunriseTime) / (sunsetTime - sunriseTime)) * 100;
            }
            
            document.getElementById('sunFill').style.width = `${percentage}%`;
            document.getElementById('sunPosition').style.left = `${percentage}%`;
        }

        function updateForecast(daily) {
            const forecastList = document.getElementById('forecastList');
            const days = ['Dim', 'Lun', 'Mar', 'Mer', 'Jeu', 'Ven', 'Sam'];
            
            let html = '';
            for (let i = 0; i < 7; i++) {
                const date = new Date(daily.time[i]);
                const dayName = i === 0 ? "Aujourd'hui" : days[date.getDay()];
                const dateStr = date.toLocaleDateString('fr-FR', { day: 'numeric', month: 'short' });
                
                html += `
                    <div class="meteo-forecast-item ${i === 0 ? 'today' : ''}">
                        <div class="forecast-day">
                            <span class="forecast-day-name">${dayName}</span>
                            <span class="forecast-day-date">${dateStr}</span>
                            <span class="forecast-day-desc">${getWeatherDescription(daily.weather_code[i])}</span>
                        </div>
                        <div class="forecast-icon">${getWeatherIconV2(daily.weather_code[i], 'medium')}</div>
                        <div class="forecast-precip">
                            <span class="material-icons">water_drop</span>
                            ${daily.precipitation_probability_max[i] || 0}%
                        </div>
                        <div class="forecast-temps">
                            <span class="forecast-temp-max">${Math.round(daily.temperature_2m_max[i])}¬∞</span>
                            <span class="forecast-temp-min">${Math.round(daily.temperature_2m_min[i])}¬∞</span>
                        </div>
                    </div>
                `;
            }
            
            forecastList.innerHTML = html;
        }

        function updateExtras(current, daily) {
            document.getElementById('pressure').textContent = Math.round(current.surface_pressure) + ' hPa';
            document.getElementById('cloudCover').textContent = current.cloud_cover + '%';
            document.getElementById('uvIndex').textContent = daily.uv_index_max[0] || '--';
            document.getElementById('visibility').textContent = '10+ km';
        }

        // ============================================
        // IC√îNES M√âT√âO v2 (modernes avec nuages sombres)
        // ============================================
        function getWeatherIconV2(code, size = 'medium') {
            // Soleil
            if (code === 0) {
                return `<span class="weather-icon-v2 wi-sun ${size}"></span>`;
            }
            // Partiellement nuageux
            if ([1, 2].includes(code)) {
                return `<span class="weather-icon-v2 wi-partly-cloudy ${size}"><span class="sun"></span><span class="cloud"></span></span>`;
            }
            // Couvert
            if (code === 3) {
                return `<span class="weather-icon-v2 wi-cloudy ${size}"><span class="cloud-back"></span><span class="cloud-front"></span></span>`;
            }
            // Brouillard
            if ([45, 48].includes(code)) {
                return `<span class="weather-icon-v2 wi-fog ${size}"><span class="line"></span><span class="line"></span><span class="line"></span></span>`;
            }
            // Bruine
            if ([51, 53, 55].includes(code)) {
                return `<span class="weather-icon-v2 wi-drizzle ${size}"><span class="cloud"></span><span class="drops"><span class="drop"></span><span class="drop"></span><span class="drop"></span></span></span>`;
            }
            // Pluie l√©g√®re √† mod√©r√©e
            if ([61, 63, 80, 81].includes(code)) {
                return `<span class="weather-icon-v2 wi-rain ${size}"><span class="cloud"></span><span class="drops"><span class="drop"></span><span class="drop"></span><span class="drop"></span></span></span>`;
            }
            // Forte pluie
            if ([65, 66, 67, 82].includes(code)) {
                return `<span class="weather-icon-v2 wi-heavy-rain ${size}"><span class="cloud"></span><span class="drops"><span class="drop"></span><span class="drop"></span><span class="drop"></span><span class="drop"></span><span class="drop"></span></span></span>`;
            }
            // Neige
            if ([71, 73, 75, 77, 85, 86].includes(code)) {
                return `<span class="weather-icon-v2 wi-snow ${size}"><span class="cloud"></span><span class="flakes"><span class="flake"></span><span class="flake"></span><span class="flake"></span></span></span>`;
            }
            // Orage
            if ([95, 96, 99].includes(code)) {
                return `<span class="weather-icon-v2 wi-thunder ${size}"><span class="cloud"></span><span class="bolt">‚ö°</span></span>`;
            }
            // Par d√©faut : partiellement nuageux
            return `<span class="weather-icon-v2 wi-partly-cloudy ${size}"><span class="sun"></span><span class="cloud"></span></span>`;
        }

        function getWeatherDescription(code) {
            const descriptions = {
                0: 'Ciel d√©gag√©',
                1: 'Principalement d√©gag√©',
                2: 'Partiellement nuageux',
                3: 'Couvert',
                45: 'Brouillard',
                48: 'Brouillard givrant',
                51: 'Bruine l√©g√®re',
                53: 'Bruine mod√©r√©e',
                55: 'Bruine dense',
                61: 'Pluie l√©g√®re',
                63: 'Pluie mod√©r√©e',
                65: 'Pluie forte',
                66: 'Pluie vergla√ßante l√©g√®re',
                67: 'Pluie vergla√ßante forte',
                71: 'Neige l√©g√®re',
                73: 'Neige mod√©r√©e',
                75: 'Neige forte',
                77: 'Grains de neige',
                80: 'Averses l√©g√®res',
                81: 'Averses mod√©r√©es',
                82: 'Averses violentes',
                85: 'Averses de neige l√©g√®res',
                86: 'Averses de neige fortes',
                95: 'Orage',
                96: 'Orage avec gr√™le l√©g√®re',
                99: 'Orage avec gr√™le forte'
            };
            return descriptions[code] || 'Conditions variables';
        }
    </script>
</body>
</html>
