/* Toutes les règles sont à l'intérieur du bloc @supports pour n'affecter que iOS */
@supports (-webkit-touch-callout: none) {
  /* Variables iOS uniquement */
  :root {
    --safe-area-top: env(safe-area-inset-top, 0px);
    --safe-area-bottom: env(safe-area-inset-bottom, 0px);
    --safe-area-left: env(safe-area-inset-left, 0px);
    --safe-area-right: env(safe-area-inset-right, 0px);
    --ios-header-height: 70px;
    --ios-bottom-nav-height: 65px;
  }

  /* Structure de base */
  body {
    padding-top: var(--safe-area-top);
    -webkit-overflow-scrolling: touch;
    overscroll-behavior-y: none;
  }

  html, body {
    width: 100%;
    overflow-x: hidden;
    max-width: 100vw;
  }

  /* En-tête principal */
  .app-header {
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    right: 0 !important;
    height: var(--ios-header-height) !important;
    padding-top: var(--safe-area-top) !important;
    z-index: 1050 !important;
    display: flex !important;
    justify-content: center !important;
    align-items: center !important;
    background-color: var(--header-bg, #5ebcec) !important;
  }

  /* Logo du site */
  .site-logo, .site-title img {
    height: 45px !important;
    max-width: 70% !important;
    object-fit: contain !important;
    margin: 0 auto !important;
    margin-top: 5px !important;
  }

  /* Bouton Menu */
  .menu-button, .hamburger-menu {
    position: fixed !important;
    top: calc(var(--safe-area-top) + 12px) !important;
    left: 15px !important;
    z-index: 1060 !important;
    width: 44px !important;
    height: 44px !important;
  }

  /* Bouton Paramètres */
  .settings-button, .gear-icon {
    position: fixed !important;
    top: calc(var(--safe-area-top) + 12px) !important;
    right: 15px !important;
    z-index: 1060 !important;
    width: 44px !important;
    height: 44px !important;
  }

  /* Bouton Infos en direct */
  .button-group {
    position: relative !important;
    margin: 15px auto 10px !important;
    text-align: center !important;
    z-index: 1030 !important;
  }

  .news-button {
    margin: 0 auto !important;
    position: relative !important;
    z-index: 1030 !important;
    top: 0 !important;
    left: 0 !important;
    right: 0 !important;
  }

  /* Masquer le bouton de lien (icône de chaîne) qui apparaît à droite */
  a[href="#"] img,
  [data-icon="link"],
  .quick-links-show-btn {
    display: none !important;
  }

  /* Contenu principal */
  main, #tileContainer, .main-content, .tile-container {
    position: relative !important;
    z-index: 1000 !important;
    margin-top: calc(var(--ios-header-height) + 5px) !important;
    padding-bottom: calc(var(--safe-area-bottom) + var(--ios-bottom-nav-height) + 50px) !important;
    padding-left: 10px !important;
    padding-right: 10px !important;
    box-sizing: border-box !important;
  }

  /* Barre d'infos (ticker) */
  .news-ticker, .bottom-bar, .ticker {
    position: fixed !important;
    bottom: calc(var(--ios-bottom-nav-height) + var(--safe-area-bottom)) !important;
    left: 0 !important;
    right: 0 !important;
    height: 36px !important;
    z-index: 1020 !important;
    overflow: hidden !important;
    background-color: rgba(0, 0, 0, 0.75) !important;
  }

  .ticker-wrapper {
    height: 100% !important;
    display: flex !important;
    align-items: center !important;
    padding-top: 0 !important;
    padding-bottom: 0 !important;
  }

  /* Navigation inférieure */
  .bottom-nav {
    position: fixed !important;
    bottom: 0 !important;
    left: 0 !important;
    right: 0 !important;
    height: var(--ios-bottom-nav-height) !important;
    padding-bottom: var(--safe-area-bottom) !important;
    z-index: 1030 !important;
    background-color: var(--bottom-nav-bg, #5ebcec) !important;
    display: flex !important;
    justify-content: space-around !important;
    align-items: center !important;
  }

  /* Boutons de navigation */
  .nav-item {
    display: flex !important;
    flex-direction: column !important;
    align-items: center !important;
    justify-content: center !important;
    height: calc(var(--ios-bottom-nav-height) - 15px) !important;
    width: 16.66% !important; /* 6 boutons = 100% / 6 */
    padding-top: 3px !important;
    padding-bottom: 3px !important;
  }

  .nav-item .material-icons {
    font-size: 24px !important;
    margin-bottom: 2px !important;
  }

  .nav-item span:not(.material-icons) {
    font-size: 11px !important;
    line-height: 1.1 !important;
    text-align: center !important;
    max-width: 100% !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
    white-space: nowrap !important;
  }

  /* Optimisations tactiles */
  * {
    -webkit-tap-highlight-color: transparent !important;
    touch-action: manipulation !important;
  }

  input, button, a {
    cursor: pointer !important;
  }

  input[type="text"], textarea, select {
    font-size: 16px !important; /* Empêcher le zoom indésirable sur les inputs */
  }

  /* Petits écrans iPhone SE, Mini */
  @media only screen and (max-width: 375px) {
    .site-logo, .site-title img {
      height: 40px !important;
    }

    .nav-item span:not(.material-icons) {
      font-size: 10px !important;
    }

    .news-ticker, .bottom-bar, .ticker {
      height: 32px !important;
    }
  }

  /* iPhone avec encoche/Dynamic Island */
  @media only screen and (min-width: 375px) and (max-width: 428px) and (device-aspect-ratio: 9/19.5) {
    .app-header {
      height: calc(var(--ios-header-height) + 10px) !important;
    }
    
    .menu-button, .hamburger-menu {
      top: calc(var(--safe-area-top) + 15px) !important;
    }
    
    .settings-button, .gear-icon {
      top: calc(var(--safe-area-top) + 15px) !important;
    }
  }

  /* Orientation paysage */
  @media screen and (orientation: landscape) {
    .app-header {
      height: calc(var(--ios-header-height) - 10px) !important;
    }

    .site-logo, .site-title img {
      height: 35px !important;
      margin-top: 0 !important;
    }
    
    main, #tileContainer, .main-content, .tile-container {
      margin-top: calc(var(--ios-header-height) - 15px) !important;
    }
    
    .bottom-nav {
      height: calc(var(--ios-bottom-nav-height) - 10px) !important;
    }
    
    .news-ticker, .bottom-bar, .ticker {
      bottom: calc(var(--ios-bottom-nav-height) - 10px + var(--safe-area-bottom)) !important;
      height: 28px !important;
    }
  }
}