/* ===== OPTIMISATIONS iOS SAFARI ===== */

/* Fix pour la hauteur 100vh problématique sur iOS Safari */
:root {
  --vh: 1vh;
}

/* Support des variables CSS pour la hauteur réelle */
@supports (-webkit-appearance: none) {
  :root {
    --vh: 1vh;
  }
}

/* Reset et base pour iOS */
*, *::before, *::after {
  -webkit-tap-highlight-color: transparent;
  -webkit-touch-callout: none;
}

html, body {
  height: 100%;
  -webkit-overflow-scrolling: touch;
  -webkit-text-size-adjust: 100%;
  -ms-text-size-adjust: 100%;
  overscroll-behavior-y: none; /* Évite le bounce sur iOS */
}

/* Fix pour les inputs sur iOS Safari */
input, textarea, select {
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;
  border-radius: 0;
  background-color: transparent;
  font-size: 16px; /* Empêche le zoom automatique */
  transform: translateZ(0); /* Force l'accélération matérielle */
}

/* Fix spécifique pour les inputs de recherche sur iOS */
input[type="search"] {
  -webkit-appearance: none;
  border-radius: 0;
}

/* Fix pour les boutons sur iOS */
button {
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;
  border-radius: 0;
  cursor: pointer;
  background: none;
  border: none;
  transform: translateZ(0);
}

/* Fix pour les liens et zones touchables */
a, button, [role="button"], .clickable {
  -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1);
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  user-select: none;
  touch-action: manipulation;
}

/* Fix pour les images sur iOS */
img {
  max-width: 100%;
  height: auto;
  -webkit-user-drag: none;
  -webkit-user-select: none;
  user-select: none;
}

/* Fix pour le Swiper sur iOS */
.swiper-container, .swiper {
  -webkit-overflow-scrolling: touch;
  transform: translateZ(0);
}

.swiper-slide {
  transform: translateZ(0);
  -webkit-backface-visibility: hidden;
  backface-visibility: hidden;
}

/* Fix pour les modales et overlays sur iOS */
.modal, .overlay, .sidebar, .news-panel {
  -webkit-overflow-scrolling: touch;
  transform: translateZ(0);
}

/* Fix pour la barre de navigation du bas sur iOS */
.bottom-nav {
  padding-bottom: env(safe-area-inset-bottom, 0);
  background: var(--bg-color);
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  z-index: 1000;
}

/* Fix pour le header avec la zone safe area */
.app-header {
  padding-top: env(safe-area-inset-top, 0);
}

/* Fix pour la sidebar avec safe area */
.sidebar {
  padding-top: env(safe-area-inset-top, 20px);
  padding-left: env(safe-area-inset-left, 0);
  transform: translateZ(0);
}

/* Fix pour les widgets flottants */
.weather-sidebar, .quick-links-sidebar {
  transform: translateZ(0);
  -webkit-overflow-scrolling: touch;
}

/* Fix pour le scroll momentum sur tous les éléments scrollables */
.swiper-wrapper,
.panel-content,
.sidebar,
.news-panel,
.modal-content {
  -webkit-overflow-scrolling: touch;
}

/* Fix pour les transitions et animations sur iOS */
.swiper-slide-active,
.modal.show,
.sidebar.open {
  -webkit-transform: translateZ(0);
  transform: translateZ(0);
  -webkit-backface-visibility: hidden;
  backface-visibility: hidden;
}

/* Fix pour les inputs dans les modales sur iOS */
.modal input, .sidebar input, .chat-input {
  font-size: 16px !important; /* Force 16px pour éviter le zoom */
  -webkit-appearance: none;
  border-radius: 0;
}

/* Fix pour les videos et iframes sur iOS */
video, iframe {
  -webkit-transform: translateZ(0);
  transform: translateZ(0);
}

/* Fix pour le chat et keyboard sur iOS */
.chat-container {
  padding-bottom: env(safe-area-inset-bottom, 0);
  -webkit-overflow-scrolling: touch;
}

/* Fix pour les notifications et badges */
.chat-notification-badge,
.notification {
  transform: translateZ(0);
}

/* Fix pour les gestures et le pinch-to-zoom */
.tile-container {
  touch-action: pan-y pinch-zoom;
}

/* Fix spécifique pour iOS 15+ */
@supports (-webkit-touch-callout: none) {
  .bottom-nav {
    padding-bottom: max(env(safe-area-inset-bottom), 20px);
  }
  
  .app-header {
    padding-top: max(env(safe-area-inset-top), 10px);
  }
}

/* Fix pour les problèmes de performance sur iOS */
.swiper-container,
.tile-container,
.news-panel,
.sidebar {
  will-change: transform;
  -webkit-transform: translateZ(0);
  transform: translateZ(0);
}

/* Fix pour les problèmes de focus sur iOS */
input:focus, textarea:focus {
  -webkit-user-select: text;
  user-select: text;
}

/* Fix pour les problèmes de sticky positioning sur iOS Safari */
.app-header {
  position: -webkit-sticky;
  position: sticky;
  top: 0;
  z-index: 100;
}

/* Fix pour l'overscroll sur iOS */
body {
  overscroll-behavior: none;
  -webkit-overflow-scrolling: touch;
}

/* Fix pour les problèmes de layout sur iOS en landscape */
@media screen and (orientation: landscape) and (max-height: 500px) {
  .app-header h1 {
    font-size: 1.2rem;
  }
  
  .bottom-nav {
    padding: 5px 0 max(env(safe-area-inset-bottom), 5px) 0;
  }
  
  .bottom-nav span:not(.material-icons) {
    font-size: 0.7rem;
  }
}

/* ===== CORRECTIONS iOS SPÉCIFIQUES SUPPLÉMENTAIRES ===== */

/* Fix pour la gestion du viewport sur iOS Safari */
.ios-device html {
  height: 100%;
  height: -webkit-fill-available;
}

.ios-device body {
  min-height: 100vh;
  min-height: -webkit-fill-available;
  position: relative;
  overflow-x: hidden;
}

/* Fix pour les tuiles qui ne sont pas cliquables sur iOS */
.ios-device .tile {
  cursor: pointer;
  -webkit-user-select: none;
  user-select: none;
  -webkit-touch-callout: none;
  touch-action: manipulation;
  position: relative;
  z-index: 1;
}

/* Fix pour le Swiper qui ne fonctionne pas bien sur iOS */
.ios-device .swiper {
  -webkit-overflow-scrolling: touch;
  overflow: hidden;
  touch-action: pan-y;
}

.ios-device .swiper-slide {
  -webkit-backface-visibility: hidden;
  backface-visibility: hidden;
  will-change: transform;
}

/* Fix pour les boutons de navigation qui ne répondent pas */
.ios-device .nav-item,
.ios-device .menu-button,
.ios-device .settings-button {
  -webkit-tap-highlight-color: transparent;
  touch-action: manipulation;
  cursor: pointer;
}

/* Fix pour les menus et modales */
.ios-device .sidebar,
.ios-device .settings-menu {
  -webkit-overflow-scrolling: touch;
  will-change: transform;
  transform: translateZ(0);
}

/* Fix pour les problèmes de chat sur iOS */
.ios-device .chat-container {
  position: fixed;
  -webkit-overflow-scrolling: touch;
  touch-action: pan-y;
}

/* Fix pour les inputs dans le chat */
.ios-device .chat-input textarea {
  -webkit-appearance: none;
  border-radius: 8px;
  resize: none;
  font-size: 16px !important;
}

/* Fix pour les widgets flottants */
.ios-device .weather-sidebar,
.ios-device .quick-links-sidebar {
  -webkit-overflow-scrolling: touch;
  will-change: transform;
  transform: translateZ(0);
}

/* Fix pour le news panel qui peut bloquer */
.ios-device .news-panel {
  -webkit-overflow-scrolling: touch;
  touch-action: pan-y;
  will-change: transform;
}

/* Fix pour les séparateurs cliquables */
.ios-device .separator {
  touch-action: manipulation;
  -webkit-tap-highlight-color: transparent;
}

/* Amélioration des performances sur iOS */
.ios-device .tile-container {
  will-change: auto;
  contain: layout style paint;
}

/* Fix pour éviter les bugs de layout sur iOS */
.ios-device main {
  contain: layout style;
  isolation: isolate;
}

/* Fix pour le problème de bounce sur iOS */
.ios-device {
  overflow: hidden;
  position: fixed;
  width: 100%;
  height: 100%;
}

.ios-device body {
  overflow-y: auto;
  overflow-x: hidden;
  -webkit-overflow-scrolling: touch;
  overscroll-behavior: none;
}